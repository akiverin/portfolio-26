---
description: 'Troubleshooting — common pitfalls, debugging, PR checklist'
alwaysApply: true
---

# Troubleshooting & PR Checklist

## Common Mistakes

### 1. Missing `observer()` wrapper

**Symptom**: Component doesn't re-render when MobX store changes.

```typescript
// ❌ BUG — no observer
const ProjectCard: React.FC<Props> = ({ store }) => {
  return <div>{store.name}</div>; // Won't update!
};
export default ProjectCard;

// ✅ FIX
import { observer } from 'mobx-react-lite';
export default observer(ProjectCard);
```

### 2. Wrong `useLocalStore` import

**Symptom**: Store doesn't get destroyed on unmount.

```typescript
// ❌ BUG — wrong import, store won't be destroyed
import { useLocalObservable } from 'mobx-react-lite';

// ✅ FIX — project's custom hook with destroy()
import { useLocalStore } from 'shared/hooks/useLocalStore';
```

### 3. Mutating observables outside action

**Symptom**: MobX strict mode warning.

```typescript
// ❌ BUG
async load() {
  const data = await fetchData();
  this._data = data; // Error in strict mode!
}

// ✅ FIX — wrap in runInAction
import { runInAction } from 'mobx';

async load() {
  const data = await fetchData();
  runInAction(() => {
    this._data = data;
  });
}
```

### 4. Forgetting `destroy()` cleanup

**Symptom**: Memory leaks, reactions running after unmount.

```typescript
// ❌ BUG — no cleanup
destroy(): void { }

// ✅ FIX — clean everything
destroy(): void {
  this._disposers.forEach((d) => d());
}
```

### 5. Not checking `isError` on API response

**Symptom**: Runtime error accessing null data.

```typescript
// ❌ BUG
const response = await getAllProjects();
this._projects = response.data; // Crash if error!

// ✅ FIX
const response = await getAllProjects();
if (response.isError) {
  this.setError(response.error);
  return;
}
this._projects = response.data;
```

### 6. Hardcoded routes

**Symptom**: Route changes break navigation silently.

```typescript
// ❌ BUG
<Link href="/auth">Login</Link>

// ✅ FIX
import { ROUTES } from 'shared/configs/routes';
<Link href={ROUTES.AUTH}>Login</Link>
```

### 7. Missing "use client" directive

**Symptom**: Error "useState/useEffect only works in Client Components".

```typescript
// ❌ BUG — no "use client" but uses hooks
import { observer } from 'mobx-react-lite';

// ✅ FIX — add directive at top of file
('use client');
import { observer } from 'mobx-react-lite';
```

## Debugging Tips

### MobX DevTools

- Use `mobx-react-lite`'s `trace()` inside `observer` to see which observables trigger re-render
- Check console for MobX strict mode violations

### Firebase Issues

- Check browser Network tab for failed Firestore requests
- Verify Firebase config env vars are set in `.env.local`
- Check Firestore Security Rules if reads/writes are denied

### Build/Lint Issues

```bash
pnpm ts-check      # Shows TypeScript errors with file locations
pnpm lint          # Checks import order, FSD layer violations, etc.
pnpm stylelint     # Checks SCSS for BEM violations
```

## PR Checklist

Before submitting a merge request:

- [ ] `pnpm check-quality` passes (ts-check + eslint + stylelint)
- [ ] No `console.log` in committed code
- [ ] No `any` types without justification comment
- [ ] No secrets or tokens in code
- [ ] All new stores implement `ILocalStore` with proper `destroy()`
- [ ] All MobX-consuming components wrapped with `observer()`
- [ ] API errors are handled — `isError` checked
- [ ] New routes use `ROUTES` config, not hardcoded strings
- [ ] SCSS uses BEM with `.root` + `$self` pattern
- [ ] Import order follows ESLint config (externals → internals → siblings → styles)
- [ ] FSD layer boundaries respected — no upward imports
